{"remainingRequest":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\src\\views\\Analysis.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\src\\views\\Analysis.vue","mtime":1747490827805},{"path":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746972278158},{"path":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1746972279218},{"path":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746972278158},{"path":"D:\\学习资料\\软件工程\\demo2\\CommentAnalysor_frontend\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1746972279591}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0FuYWx5c2lzJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcHJvZHVjdElkOiBudWxsLAogICAgICBwcm9kdWN0VXJsOiAnJywKICAgICAgY29tbWVudHM6IFtdLAogICAgICBhbGxjb21tZW50czogW10sCiAgICAgIGN1cnJlbnRQYWdlOiAxLAogICAgICBwYWdlU2l6ZTogMTAsCiAgICAgIHRvdGFsOiAwLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgc2NvcmVGaWx0ZXI6ICcwJywKICAgICAgc2VhcmNoS2V5d29yZDogJycsCiAgICAgIGtleXdvcmRzOiBbXSwKICAgICAgY3VycmVudExhbmc6ICd6aCcsCgogICAgICAvLyDor4TliIbnu5/orqEKICAgICAgYXZlcmFnZVNjb3JlOiAwLAogICAgICBzY29yZURpc3RyaWJ1dGlvbjogewogICAgICAgIDE6IDAsCiAgICAgICAgMjogMCwKICAgICAgICAzOiAwLAogICAgICAgIDQ6IDAsCiAgICAgICAgNTogMAogICAgICB9LAogICAgICBpc0FuYWx5emluZzogZmFsc2UsCiAgICAgIHNob3dTZW50aW1lbnRMZWdlbmQ6IGZhbHNlLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICAvLyDku47ot6/nlLHlj4LmlbDojrflj5bllYblk4FJRAogICAgdGhpcy5wcm9kdWN0SWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMucHJvZHVjdElkOwogICAgdGhpcy5wcm9kdWN0VXJsID0gdGhpcy4kcm91dGUucXVlcnkudXJsIHx8ICcnOwogICAgLy8g6I635Y+W5b2T5YmN6K+t6KiA6K6+572uCiAgICB0aGlzLmN1cnJlbnRMYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJykgfHwgJ3poJzsKCiAgICBpZiAodGhpcy5wcm9kdWN0SWQpIHsKICAgICAgdGhpcy5nZXRDb21tZW50cygpOwogICAgICB0aGlzLmdldHNjb3JlKCk7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgLy8g55uR5ZCs6K+t6KiA5Y+Y5YyWCiAgICAnJGkxOG4ubG9jYWxlJzogewogICAgICBoYW5kbGVyKG5ld0xhbmcpIHsKICAgICAgICB0aGlzLmN1cnJlbnRMYW5nID0gbmV3TGFuZzsKICAgICAgICAvLyDlpoLmnpzliIfmjaLliLDoi7HmlofvvIzoh6rliqjnv7vor5HmiYDmnInor4TorrrlkozlhbPplK7or40KICAgICAgICBpZiAobmV3TGFuZyA9PT0gJ2VuJykgewogICAgICAgICAgdGhpcy50cmFuc2xhdGVBbGxDb21tZW50cygpOwogICAgICAgICAgdGhpcy50cmFuc2xhdGVLZXl3b3JkcygpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMucmVzaXplV29yZENsb3VkKTsKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemVXb3JkQ2xvdWQpOwogIH0sCiAgbWV0aG9kczogewogICAgZ29CYWNrKCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnLycpOwogICAgfSwKCiAgICBhc3luYyBmZXRjaE5ld0NvbW1lbnRzKCkgewogICAgICBpZiAoIXRoaXMucHJvZHVjdFVybCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyh0aGlzLiR0KCdhbmFseXNpcy5ub0NvbW1lbnRzV2FybmluZycpKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvY29tbWVudHMvZmV0Y2gnLCB7CiAgICAgICAgICBwYXJhbXM6IHsgdXJsOiB0aGlzLnByb2R1Y3RVcmwgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAnMCcpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcyh0aGlzLiR0KCdhbmFseXNpcy5mZXRjaENvbW1lbnRzU3VjY2VzcycpKTsKICAgICAgICAgIHRoaXMuZ2V0Q29tbWVudHMoKTsKICAgICAgICAgIHRoaXMuZ2V0c2NvcmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1zZyB8fCB0aGlzLiR0KCdhbmFseXNpcy5mZXRjaENvbW1lbnRzRmFpbGVkJykpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bor4TorrrlpLHotKU6JywgZXJyb3IpOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IodGhpcy4kdCgnYW5hbHlzaXMuZmV0Y2hDb21tZW50c0ZhaWxlZCcpICsgJzogJyArIChlcnJvci5yZXNwb25zZT8uZGF0YT8ubXNnIHx8IGVycm9yLm1lc3NhZ2UpKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBhc3luYyBnZXRzY29yZSgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoJy9jb21tZW50cycsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBwYWdlTnVtOiAxLAogICAgICAgICAgICBwYWdlU2l6ZTogMjAwMDAsCiAgICAgICAgICAgIHByb2R1Y3RJZDogdGhpcy5wcm9kdWN0SWQKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gJzAnKSB7CiAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgdGhpcy5hbGxjb21tZW50cyA9IGRhdGEucmVjb3JkcyB8fCBbXTsKCiAgICAgICAgICBpZiAodGhpcy5hbGxjb21tZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfmmoLml6Dor4TorrrmlbDmja7vvIzor7fngrnlh7vkuIrmlrnmjInpkq7ojrflj5bor4TorronKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOiuoeeul+ivhOWIhue7n+iuoQogICAgICAgICAgdGhpcy5jYWxjdWxhdGVTY29yZURpc3RyaWJ1dGlvbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcocmVzcG9uc2UuZGF0YS5tc2cgfHwgJ+acquaJvuWIsOivhOiuuuaVsOaNricpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bor4TorrrliJfooajlpLHotKU6JywgZXJyb3IpOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPluivhOiuuuWIl+ihqOWksei0pTogJyArIChlcnJvci5yZXNwb25zZT8uZGF0YT8ubXNnIHx8IGVycm9yLm1lc3NhZ2UpKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBhc3luYyBnZXRDb21tZW50cygpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoJy9jb21tZW50cycsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBwYWdlTnVtOiB0aGlzLmN1cnJlbnRQYWdlLAogICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5wYWdlU2l6ZSwKICAgICAgICAgICAgcHJvZHVjdElkOiB0aGlzLnByb2R1Y3RJZAogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAnMCcpIHsKICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAvLyDnoa7kv53or4TorrrmlbDmja7kuK3ljIXlkKvnv7vor5Hnm7jlhbPlrZfmrrUKICAgICAgICAgIHRoaXMuY29tbWVudHMgPSAoZGF0YS5yZWNvcmRzIHx8IFtdKS5tYXAoY29tbWVudCA9PiAoewogICAgICAgICAgICAuLi5jb21tZW50LAogICAgICAgICAgICBzZW50aW1lbnRTY29yZTogY29tbWVudC5zZW50aW1lbnRTY29yZSB8fCBudWxsLAogICAgICAgICAgICB0cmFuc2xhdGVkQ29udGVudDogbnVsbCwKICAgICAgICAgICAgc2hvd09yaWdpbmFsOiBmYWxzZQogICAgICAgICAgfSkpOwogICAgICAgICAgdGhpcy50b3RhbCA9IGRhdGEudG90YWwgfHwgMDsKCiAgICAgICAgICBpZiAodGhpcy5jb21tZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKHRoaXMuJHQoJ2FuYWx5c2lzLm5vQ29tbWVudHNXYXJuaW5nJykpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgLy8g6I635Y+W5YWz6ZSu6K+NCiAgICAgICAgICB0aGlzLmdldEtleXdvcmRzKCk7CiAgICAgICAgICAKICAgICAgICAgIC8vIOWmguaenOW9k+WJjeaYr+iLseaWh++8jOiHquWKqOe/u+ivkeaJgOacieivhOiuugogICAgICAgICAgaWYgKHRoaXMuY3VycmVudExhbmcgPT09ICdlbicpIHsKICAgICAgICAgICAgdGhpcy50cmFuc2xhdGVBbGxDb21tZW50cygpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcocmVzcG9uc2UuZGF0YS5tc2cgfHwgdGhpcy4kdCgnYW5hbHlzaXMuZmV0Y2hDb21tZW50c0ZhaWxlZCcpKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6K+E6K665YiX6KGo5aSx6LSlOicsIGVycm9yKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHRoaXMuJHQoJ2FuYWx5c2lzLmZldGNoQ29tbWVudHNGYWlsZWQnKSArICc6ICcgKyAoZXJyb3IucmVzcG9uc2U/LmRhdGE/Lm1zZyB8fCBlcnJvci5tZXNzYWdlKSk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgZ2V0S2V5d29yZHMoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoYC9jb21tZW50cy9rZXl3b3JkczEvJHt0aGlzLnByb2R1Y3RJZH1gLCB7CiAgICAgICAgICBwYXJhbXM6IHsgdG9wTjogNTAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAnMCcpIHsKICAgICAgICAgIGNvbnN0IGtleXdvcmRzT2JqID0gcmVzcG9uc2UuZGF0YS5kYXRhLmtleXdvcmRzIHx8IHt9OwoKICAgICAgICAgIC8vIOWwhuWvueixoei9rOaNouS4uuaVsOe7hOagvOW8j++8jOmAgueUqOS6juivjeS6kQogICAgICAgICAgdGhpcy5rZXl3b3JkcyA9IE9iamVjdC5lbnRyaWVzKGtleXdvcmRzT2JqKS5tYXAoKFt0ZXh0LCB2YWx1ZV0pID0+ICh7CiAgICAgICAgICAgIHRleHQsCiAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICB0cmFuc2xhdGVkVGV4dDogbnVsbCAgLy8g5re75Yqg57+76K+R5paH5pys5a2X5q61CiAgICAgICAgICB9KSk7CgogICAgICAgICAgLy8g5aaC5p6c5b2T5YmN5piv6Iux5paH77yM57+76K+R5YWz6ZSu6K+NCiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50TGFuZyA9PT0gJ2VuJykgewogICAgICAgICAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2YgdGhpcy5rZXl3b3JkcykgewogICAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNsYXRlQ29tbWVudCh7IGNvbnRlbnQ6IGtleXdvcmQudGV4dCB9KTsgIC8vIOS9v+eUqOeOsOacieeahOe/u+ivkeaWueazlQogICAgICAgICAgICAgIGtleXdvcmQudGV4dCA9IGtleXdvcmQudHJhbnNsYXRlZENvbnRlbnQ7ICAvLyDmm7TmlrDlhbPplK7or43mlofmnKwKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIOWcqOS4i+S4gOS4qua4suafk+WRqOacn+e7mOWItuivjeS6kQogICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICB0aGlzLnJlbmRlcldvcmRDbG91ZCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluWFs+mUruivjeWksei0pTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgdHJhbnNsYXRlS2V5d29yZHMoKSB7CiAgICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiB0aGlzLmtleXdvcmRzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnL2FwaS90cmFuc2xhdGUnLCB7CiAgICAgICAgICAgIHRleHQ6IGtleXdvcmQudGV4dCwKICAgICAgICAgICAgdGFyZ2V0TGFuZzogJ2VuJwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5jb2RlID09PSAnMCcpIHsKICAgICAgICAgICAga2V5d29yZC50ZXh0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfnv7vor5HlhbPplK7or43lpLHotKU6JywgZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlKHBhZ2UpIHsKICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHBhZ2U7CiAgICAgIGlmICh0aGlzLnNjb3JlRmlsdGVyICE9PSAnMCcpIHsKICAgICAgICAvLyDlpoLmnpzlvZPliY3mnInor4TliIbnrZvpgInvvIzkvb/nlKjor4TliIbnrZvpgInmjqXlj6MKICAgICAgICB0aGlzLmZpbHRlckNvbW1lbnRzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5ZCm5YiZ5L2/55So5pmu6YCa6K+E6K666I635Y+W5o6l5Y+jCiAgICAgICAgdGhpcy5nZXRDb21tZW50cygpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGZpbHRlckNvbW1lbnRzKCkgewogICAgICBpZiAodGhpcy5zY29yZUZpbHRlciA9PT0gJzAnKSB7CiAgICAgICAgLy8g6YeN572u5Li65YWo6YOo6K+E6K66CiAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IDE7CiAgICAgICAgdGhpcy5nZXRDb21tZW50cygpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgY29uc3QgbWluU2NvcmUgPSBwYXJzZUludCh0aGlzLnNjb3JlRmlsdGVyKTsKICAgICAgY29uc3QgbWF4U2NvcmUgPSBwYXJzZUludCh0aGlzLnNjb3JlRmlsdGVyKTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoYC9jb21tZW50cy9zY29yZS8ke3RoaXMucHJvZHVjdElkfWAsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBtaW5TY29yZSwKICAgICAgICAgICAgbWF4U2NvcmUsCiAgICAgICAgICAgIHBhZ2VOdW06IHRoaXMuY3VycmVudFBhZ2UsCiAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09ICcwJykgewogICAgICAgICAgLy8g5qOA5p+l6L+U5Zue5pWw5o2u55qE57uT5p6ECiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLnJlY29yZHMpIHsKICAgICAgICAgICAgLy8g5aaC5p6c6L+U5Zue55qE5piv5YiG6aG15qC85byPCiAgICAgICAgICAgIHRoaXMuY29tbWVudHMgPSByZXNwb25zZS5kYXRhLmRhdGEucmVjb3Jkcy5tYXAoY29tbWVudCA9PiAoewogICAgICAgICAgICAgIC4uLmNvbW1lbnQsCiAgICAgICAgICAgICAgc2VudGltZW50U2NvcmU6IGNvbW1lbnQuc2VudGltZW50U2NvcmUgfHwgbnVsbAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHRoaXMudG90YWwgPSByZXNwb25zZS5kYXRhLmRhdGEudG90YWw7CiAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVzcG9uc2UuZGF0YS5kYXRhKSkgewogICAgICAgICAgICAvLyDlpoLmnpzov5Tlm57nmoTmmK/mlbDnu4TmoLzlvI/vvIzmiYvliqjlpITnkIbliIbpobUKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSAodGhpcy5jdXJyZW50UGFnZSAtIDEpICogdGhpcy5wYWdlU2l6ZTsKICAgICAgICAgICAgY29uc3QgZW5kID0gc3RhcnQgKyB0aGlzLnBhZ2VTaXplOwogICAgICAgICAgICB0aGlzLmNvbW1lbnRzID0gcmVzcG9uc2UuZGF0YS5kYXRhLnNsaWNlKHN0YXJ0LCBlbmQpLm1hcChjb21tZW50ID0+ICh7CiAgICAgICAgICAgICAgLi4uY29tbWVudCwKICAgICAgICAgICAgICBzZW50aW1lbnRTY29yZTogY29tbWVudC5zZW50aW1lbnRTY29yZSB8fCBudWxsCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgdGhpcy50b3RhbCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5sZW5ndGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbW1lbnRzID0gW107CiAgICAgICAgICAgIHRoaXMudG90YWwgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOWmguaenOacieaDheaEn+WIhuaekOaVsOaNru+8jOaYvuekuuWbvuS+iwogICAgICAgICAgaWYgKHRoaXMuY29tbWVudHMuc29tZShjb21tZW50ID0+IGNvbW1lbnQuc2VudGltZW50U2NvcmUgIT09IG51bGwpKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1NlbnRpbWVudExlZ2VuZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyhyZXNwb25zZS5kYXRhLm1zZyB8fCB0aGlzLiR0KCdhbmFseXNpcy5maWx0ZXJDb21tZW50c0ZhaWxlZCcpKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign562b6YCJ6K+E6K665aSx6LSlOicsIGVycm9yKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHRoaXMuJHQoJ2FuYWx5c2lzLmZpbHRlckNvbW1lbnRzRmFpbGVkJykgKyAnOiAnICsgKGVycm9yLnJlc3BvbnNlPy5kYXRhPy5tc2cgfHwgZXJyb3IubWVzc2FnZSkpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHNlYXJjaENvbW1lbnRzKCkgewogICAgICBpZiAoIXRoaXMuc2VhcmNoS2V5d29yZC50cmltKCkpIHsKICAgICAgICAvLyDlpoLmnpzmkJzntKLlhbPplK7or43kuLrnqbrvvIzmgaLlpI3mmL7npLrmiYDmnInor4TorroKICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTsKICAgICAgICB0aGlzLmdldENvbW1lbnRzKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldChgL2NvbW1lbnRzL3NlYXJjaC8ke3RoaXMucHJvZHVjdElkfWAsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBrZXl3b3JkOiB0aGlzLnNlYXJjaEtleXdvcmQudHJpbSgpCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09ICcwJykgewogICAgICAgICAgdGhpcy5jb21tZW50cyA9IChyZXNwb25zZS5kYXRhLmRhdGEgfHwgW10pLm1hcChjb21tZW50ID0+ICh7CiAgICAgICAgICAgIC4uLmNvbW1lbnQsCiAgICAgICAgICAgIHNlbnRpbWVudFNjb3JlOiBjb21tZW50LnNlbnRpbWVudFNjb3JlIHx8IG51bGwKICAgICAgICAgIH0pKTsKICAgICAgICAgIHRoaXMudG90YWwgPSB0aGlzLmNvbW1lbnRzLmxlbmd0aDsKICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxOwoKICAgICAgICAgIC8vIOWmguaenOacieaDheaEn+WIhuaekOaVsOaNru+8jOaYvuekuuWbvuS+iwogICAgICAgICAgaWYgKHRoaXMuY29tbWVudHMuc29tZShjb21tZW50ID0+IGNvbW1lbnQuc2VudGltZW50U2NvcmUgIT09IG51bGwpKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1NlbnRpbWVudExlZ2VuZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyhyZXNwb25zZS5kYXRhLm1zZyB8fCB0aGlzLiR0KCdhbmFseXNpcy5zZWFyY2hDb21tZW50c0ZhaWxlZCcpKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5pCc57Si6K+E6K665aSx6LSlOicsIGVycm9yKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHRoaXMuJHQoJ2FuYWx5c2lzLnNlYXJjaENvbW1lbnRzRmFpbGVkJykgKyAnOiAnICsgKGVycm9yLnJlc3BvbnNlPy5kYXRhPy5tc2cgfHwgZXJyb3IubWVzc2FnZSkpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGNhbGN1bGF0ZVNjb3JlRGlzdHJpYnV0aW9uKCkgewogICAgICBpZiAoIXRoaXMuYWxsY29tbWVudHMgfHwgdGhpcy5hbGxjb21tZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLmF2ZXJhZ2VTY29yZSA9IDA7CiAgICAgICAgdGhpcy5zY29yZURpc3RyaWJ1dGlvbiA9IHsgMTogMCwgMjogMCwgMzogMCwgNDogMCwgNTogMCB9OwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5Yid5aeL5YyW6K6h5pWw5ZmoCiAgICAgIGNvbnN0IHNjb3JlQ291bnRzID0geyAxOiAwLCAyOiAwLCAzOiAwLCA0OiAwLCA1OiAwIH07CiAgICAgIGxldCB0b3RhbFNjb3JlID0gMDsKCiAgICAgIC8vIOiuoeeul+avj+S4quivhOWIhueahOaVsOmHj+WSjOaAu+WIhgogICAgICB0aGlzLmFsbGNvbW1lbnRzLmZvckVhY2goY29tbWVudCA9PiB7CiAgICAgICAgaWYgKGNvbW1lbnQuc2NvcmUgPj0gMSAmJiBjb21tZW50LnNjb3JlIDw9IDUpIHsKICAgICAgICAgIHNjb3JlQ291bnRzW2NvbW1lbnQuc2NvcmVdKys7CiAgICAgICAgICB0b3RhbFNjb3JlICs9IGNvbW1lbnQuc2NvcmU7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOiuoeeul+W5s+Wdh+WIhgogICAgICB0aGlzLmF2ZXJhZ2VTY29yZSA9IHRvdGFsU2NvcmUgLyB0aGlzLmFsbGNvbW1lbnRzLmxlbmd0aDsKCiAgICAgIC8vIOiuoeeul+avj+S4quivhOWIhueahOeZvuWIhuavlAogICAgICBjb25zdCB0b3RhbCA9IHRoaXMuYWxsY29tbWVudHMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA1OyBpKyspIHsKICAgICAgICB0aGlzLnNjb3JlRGlzdHJpYnV0aW9uW2ldID0gTWF0aC5yb3VuZCgoc2NvcmVDb3VudHNbaV0gLyB0b3RhbCkgKiAxMDApOwogICAgICB9CiAgICB9LAoKICAgIHJlbmRlcldvcmRDbG91ZCgpIHsKICAgICAgaWYgKCF0aGlzLmtleXdvcmRzIHx8IHRoaXMua2V5d29yZHMubGVuZ3RoID09PSAwIHx8ICF0aGlzLiRyZWZzLndvcmRDbG91ZCkgcmV0dXJuOwoKICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy4kcmVmcy53b3JkQ2xvdWQ7CiAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKCiAgICAgIC8vIOiuvue9ruWtl+S9k+Wkp+Wwj+iMg+WbtAogICAgICBjb25zdCBtYXhGb250U2l6ZSA9IDQyOwogICAgICBjb25zdCBtaW5Gb250U2l6ZSA9IDE0OwoKICAgICAgLy8g5om+5Ye65pyA5aSn5ZKM5pyA5bCP5p2D6YeN5YC8CiAgICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMua2V5d29yZHMubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7CiAgICAgIGNvbnN0IG1heFZhbHVlID0gTWF0aC5tYXgoLi4udmFsdWVzKTsKICAgICAgY29uc3QgbWluVmFsdWUgPSBNYXRoLm1pbiguLi52YWx1ZXMpOwoKICAgICAgLy8g5a6a5LmJ5LiA57uE576O6KeC55qE6aKc6ImyCiAgICAgIGNvbnN0IGNvbG9ycyA9IFsKICAgICAgICAnIzNhN2JkNScsICcjMDBkMmZmJywgJyMxMTk5OGUnLCAnIzM4ZWY3ZCcsCiAgICAgICAgJyNhOGZmNzgnLCAnI2Y4NTdhNicsICcjZmY1ODU4JywgJyNmY2IwNDUnLAogICAgICAgICcjN2I0Mzk3JywgJyNkYzI0MzAnLCAnIzQ1NjhkYycsICcjYjA2YWIzJwogICAgICBdOwoKICAgICAgdGhpcy5rZXl3b3Jkcy5mb3JFYWNoKGtleXdvcmQgPT4gewogICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgc3Bhbi5jbGFzc05hbWUgPSAna2V5d29yZCc7CiAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IGtleXdvcmQudGV4dDsKCiAgICAgICAgLy8g6K6h566X5a2X5L2T5aSn5bCPCiAgICAgICAgY29uc3QgZm9udFNpemUgPSBtaW5WYWx1ZSA9PT0gbWF4VmFsdWUKICAgICAgICAgICAgPyAobWF4Rm9udFNpemUgKyBtaW5Gb250U2l6ZSkgLyAyCiAgICAgICAgICAgIDogbWluRm9udFNpemUgKyAoa2V5d29yZC52YWx1ZSAtIG1pblZhbHVlKSAvIChtYXhWYWx1ZSAtIG1pblZhbHVlKSAqIChtYXhGb250U2l6ZSAtIG1pbkZvbnRTaXplKTsKCiAgICAgICAgLy8g6ZqP5py66YCJ5oup6aKc6ImyCiAgICAgICAgY29uc3QgY29sb3IgPSBjb2xvcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY29sb3JzLmxlbmd0aCldOwoKICAgICAgICAvLyDorr7nva7moLflvI8KICAgICAgICBzcGFuLnN0eWxlLmZvbnRTaXplID0gYCR7Zm9udFNpemV9cHhgOwogICAgICAgIHNwYW4uc3R5bGUuY29sb3IgPSBjb2xvcjsKICAgICAgICBzcGFuLnN0eWxlLmZvbnRXZWlnaHQgPSBNYXRoLmZsb29yKGZvbnRTaXplIC8gNSkgKiAxMDA7CiAgICAgICAgc3Bhbi5zdHlsZS5vcGFjaXR5ID0gMC45IC0gKDAuMyAqIChmb250U2l6ZSAtIG1pbkZvbnRTaXplKSAvIChtYXhGb250U2l6ZSAtIG1pbkZvbnRTaXplKSk7CiAgICAgICAgc3Bhbi5zdHlsZS50cmFuc2l0aW9uID0gJ2FsbCAwLjNzIGVhc2UnOwoKICAgICAgICAvLyDpvKDmoIfmgqzlgZzmlYjmnpwKICAgICAgICBzcGFuLm9ubW91c2VlbnRlciA9ICgpID0+IHsKICAgICAgICAgIHNwYW4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmNWY3ZmEnOwogICAgICAgICAgc3Bhbi5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgIH07CiAgICAgICAgc3Bhbi5vbm1vdXNlbGVhdmUgPSAoKSA9PiB7CiAgICAgICAgICBzcGFuLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCc7CiAgICAgICAgfTsKCiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwYW4pOwogICAgICB9KTsKICAgIH0sCgogICAgcmVzaXplV29yZENsb3VkKCkgewogICAgICB0aGlzLnJlbmRlcldvcmRDbG91ZCgpOwogICAgfSwKCiAgICBnZXRTY29yZUNvbG9yKHNjb3JlKSB7CiAgICAgIGlmIChzY29yZSA+PSA0LjUpIHJldHVybiAnIzY3QzIzQSc7IC8vIOe7v+iJsiAtIOS8mOengAogICAgICBpZiAoc2NvcmUgPj0gNCkgcmV0dXJuICcjODVDRTYxJzsgICAvLyDmtYXnu7/oibIgLSDoia/lpb0KICAgICAgaWYgKHNjb3JlID49IDMpIHJldHVybiAnI0U2QTIzQyc7ICAgLy8g6buE6ImyIC0g5LiA6IisCiAgICAgIGlmIChzY29yZSA+PSAyKSByZXR1cm4gJyNGNTZDNkMnOyAgIC8vIOe6ouiJsiAtIOi+g+W3rgogICAgICByZXR1cm4gJyNGNTZDNkMnOyAgICAgICAgICAgICAgICAgICAvLyDmt7HnuqLoibIgLSDlvojlt64KICAgIH0sCgogICAgZXhwb3J0S2V5d29yZHMoKSB7CiAgICAgIC8vIOWwhuWFs+mUruivjei9rOaNouS4ukNTVuagvOW8jwogICAgICBjb25zdCBjc3ZDb250ZW50ID0gImRhdGE6dGV4dC9jc3Y7Y2hhcnNldD11dGYtOCwiCiAgICAgICAgICArICLlhbPplK7or40s6aKR546HXG4iCiAgICAgICAgICArIHRoaXMua2V5d29yZHMubWFwKGsgPT4gYCR7ay50ZXh0fSwke2sudmFsdWV9YCkuam9pbigiXG4iKTsKCiAgICAgIC8vIOWIm+W7uuS4i+i9vemTvuaOpQogICAgICBjb25zdCBlbmNvZGVkVXJpID0gZW5jb2RlVVJJKGNzdkNvbnRlbnQpOwogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGVuY29kZWRVcmkpOwogICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBg5ZWG5ZOBXyR7dGhpcy5wcm9kdWN0SWR9X+WFs+mUruivjS5jc3ZgKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKCiAgICAgIC8vIOinpuWPkeS4i+i9vQogICAgICBsaW5rLmNsaWNrKCk7CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7CgogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3ModGhpcy4kdCgnYW5hbHlzaXMuZXhwb3J0S2V5d29yZHNTdWNjZXNzJykpOwogICAgfSwKCiAgICBhc3luYyBhbmFseXplU2VudGltZW50KCkgewogICAgICBpZiAodGhpcy5jb21tZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcodGhpcy4kdCgnYW5hbHlzaXMubm9Db21tZW50c1dhcm5pbmcnKSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmlzQW5hbHl6aW5nID0gdHJ1ZTsKICAgICAgdGhpcy5zaG93U2VudGltZW50TGVnZW5kID0gdHJ1ZTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KGAvY29tbWVudHMvc2VudGltZW50LyR7dGhpcy5wcm9kdWN0SWR9YCwgewogICAgICAgICAgY29tbWVudHM6IHRoaXMuY29tbWVudHMubWFwKGNvbW1lbnQgPT4gKHsKICAgICAgICAgICAgaWQ6IGNvbW1lbnQuaWQsCiAgICAgICAgICAgIGNvbnRlbnQ6IGNvbW1lbnQuY29udGVudAogICAgICAgICAgfSkpCiAgICAgICAgfSk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09ICcwJykgewogICAgICAgICAgY29uc3Qgc2VudGltZW50UmVzdWx0cyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIC8vIOabtOaWsOivhOiuuueahOaDheaEn+WIhuaVsAogICAgICAgICAgdGhpcy5jb21tZW50cyA9IHRoaXMuY29tbWVudHMubWFwKGNvbW1lbnQgPT4gewogICAgICAgICAgICBjb25zdCBzZW50aW1lbnRTY29yZSA9IHNlbnRpbWVudFJlc3VsdHNbY29tbWVudC5pZF07CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uY29tbWVudCwKICAgICAgICAgICAgICBzZW50aW1lbnRTY29yZTogc2VudGltZW50U2NvcmUgIT09IHVuZGVmaW5lZCA/IHNlbnRpbWVudFNjb3JlIDogMC41CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcyh0aGlzLiR0KCdhbmFseXNpcy5zZW50aW1lbnRBbmFseXNpc1N1Y2Nlc3MnKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tc2cgfHwgdGhpcy4kdCgnYW5hbHlzaXMuc2VudGltZW50QW5hbHlzaXNGYWlsZWQnKSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aDheaEn+WIhuaekOWksei0pTonLCBlcnJvcik7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcih0aGlzLiR0KCdhbmFseXNpcy5zZW50aW1lbnRBbmFseXNpc0ZhaWxlZCcpICsgJzogJyArIChlcnJvci5yZXNwb25zZT8uZGF0YT8ubXNnIHx8IGVycm9yLm1lc3NhZ2UpKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmlzQW5hbHl6aW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgZ2V0U2VudGltZW50U3R5bGUoc2NvcmUpIHsKICAgICAgLy8g5qC55o2u5oOF5oSf5YiG5pWw6L+U5Zue5a+55bqU55qE6IOM5pmv6ImyCiAgICAgIGlmIChzY29yZSA+PSAwLjYpIHsKICAgICAgICByZXR1cm4geyBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDEwMywgMTk0LCA1OCwgMC4xKScgfTsgLy8g56ev5p6BIC0g5rWF57u/6ImyCiAgICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gMC40KSB7CiAgICAgICAgcmV0dXJuIHsgYmFja2dyb3VuZENvbG9yOiAncmdiYSgyMzAsIDE2MiwgNjAsIDAuMSknIH07IC8vIOS4reaApyAtIOa1hem7hOiJsgogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7IGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjQ1LCAxMDgsIDEwOCwgMC4xKScgfTsgLy8g5raI5p6BIC0g5rWF57qi6ImyCiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgdHJhbnNsYXRlQ29tbWVudChjb21tZW50KSB7CiAgICAgIGlmICghY29tbWVudC5jb250ZW50KSByZXR1cm47CiAgICAgIAogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnL2FwaS90cmFuc2xhdGUnLCB7CiAgICAgICAgICB0ZXh0OiBjb21tZW50LmNvbnRlbnQsCiAgICAgICAgICB0YXJnZXRMYW5nOiAnZW4nCiAgICAgICAgfSk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gJzAnKSB7CiAgICAgICAgICAvLyDkvb/nlKggVnVlLnNldCDnoa7kv53lk43lupTlvI/mm7TmlrAKICAgICAgICAgIHRoaXMuJHNldChjb21tZW50LCAndHJhbnNsYXRlZENvbnRlbnQnLCByZXNwb25zZS5kYXRhLmRhdGEpOwogICAgICAgICAgdGhpcy4kc2V0KGNvbW1lbnQsICdzaG93T3JpZ2luYWwnLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tc2cgfHwgdGhpcy4kdCgnYW5hbHlzaXMudHJhbnNsYXRlRmFpbGVkJykpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfnv7vor5HlpLHotKU6JywgZXJyb3IpOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IodGhpcy4kdCgnYW5hbHlzaXMudHJhbnNsYXRlRmFpbGVkJykpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHRyYW5zbGF0ZUFsbENvbW1lbnRzKCkgewogICAgICBmb3IgKGNvbnN0IGNvbW1lbnQgb2YgdGhpcy5jb21tZW50cykgewogICAgICAgIGlmICghY29tbWVudC50cmFuc2xhdGVkQ29udGVudCkgewogICAgICAgICAgYXdhaXQgdGhpcy50cmFuc2xhdGVDb21tZW50KGNvbW1lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICB0b2dnbGVPcmlnaW5hbENvbnRlbnQoY29tbWVudCkgewogICAgICB0aGlzLiRzZXQoY29tbWVudCwgJ3Nob3dPcmlnaW5hbCcsICFjb21tZW50LnNob3dPcmlnaW5hbCk7CiAgICB9LAogIH0KfTsK"},{"version":3,"sources":["Analysis.vue"],"names":[],"mappings":";AAwLA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Analysis.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"analysis-container\">\n    <div class=\"header-area\">\n      <div class=\"back-button\" @click=\"goBack\">\n        <i class=\"el-icon-arrow-left\"></i> {{ $t('analysis.back') }}\n      </div>\n      <h2 class=\"product-title\">{{ $t('analysis.title') }}</h2>\n      <div class=\"action-buttons\">\n        <div class=\"sentiment-button\" @click=\"analyzeSentiment\" v-if=\"!loading && !isAnalyzing\">\n          <i class=\"el-icon-data-analysis\"></i> {{ $t('analysis.sentimentAnalysis') }}\n        </div>\n        <div class=\"refresh-button\" @click=\"fetchNewComments\" v-if=\"!loading\">\n          <i class=\"el-icon-refresh\"></i> {{ $t('analysis.refreshComments') }}\n        </div>\n        <div class=\"loading-indicator\" v-else>\n          <i class=\"el-icon-loading\"></i> {{ $t('analysis.loading') }}\n        </div>\n      </div>\n    </div>\n\n    <el-row :gutter=\"20\" class=\"main-content\">\n      <!-- 左侧区域 - 评论列表和筛选 -->\n      <el-col :span=\"14\">\n        <el-card class=\"comment-card\">\n          <div slot=\"header\" class=\"comment-header\">\n            <span>{{ $t('analysis.commentList') }}</span>\n            <div class=\"comment-filter\">\n              <el-select v-model=\"scoreFilter\" :placeholder=\"$t('analysis.filterByScore')\" size=\"small\" @change=\"filterComments\">\n                <el-option :label=\"$t('analysis.allScores')\" value=\"0\"></el-option>\n                <el-option :label=\"$t('analysis.star1')\" value=\"1\"></el-option>\n                <el-option :label=\"$t('analysis.star2')\" value=\"2\"></el-option>\n                <el-option :label=\"$t('analysis.star3')\" value=\"3\"></el-option>\n                <el-option :label=\"$t('analysis.star4')\" value=\"4\"></el-option>\n                <el-option :label=\"$t('analysis.star5')\" value=\"5\"></el-option>\n              </el-select>\n              <el-input\n                  :placeholder=\"$t('analysis.searchPlaceholder')\"\n                  v-model=\"searchKeyword\"\n                  class=\"search-input\"\n                  size=\"small\"\n                  clearable\n                  @keyup.enter.native=\"searchComments\"\n                  prefix-icon=\"el-icon-search\"\n              >\n                <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"searchComments\"></el-button>\n              </el-input>\n            </div>\n          </div>\n\n          <!-- 情感分析颜色说明 -->\n          <div v-if=\"showSentimentLegend\" class=\"sentiment-legend\">\n            <div class=\"legend-item\">\n              <div class=\"color-block positive\"></div>\n              <span>{{ $t('analysis.sentimentLegend.positive') }}</span>\n            </div>\n            <div class=\"legend-item\">\n              <div class=\"color-block neutral\"></div>\n              <span>{{ $t('analysis.sentimentLegend.neutral') }}</span>\n            </div>\n            <div class=\"legend-item\">\n              <div class=\"color-block negative\"></div>\n              <span>{{ $t('analysis.sentimentLegend.negative') }}</span>\n            </div>\n          </div>\n\n          <div v-if=\"comments.length === 0\" class=\"empty-comments\">\n            <i class=\"el-icon-chat-dot-square empty-icon\"></i>\n            <p>{{ $t('analysis.emptyComments') }}</p>\n          </div>\n\n          <div v-else class=\"comment-list\">\n            <div v-for=\"comment in comments\" :key=\"comment.id\" \n                 class=\"comment-item\"\n                 :class=\"{'has-sentiment': showSentimentLegend && comment.sentimentScore !== null}\"\n                 :style=\"showSentimentLegend && comment.sentimentScore !== null ? getSentimentStyle(comment.sentimentScore) : { backgroundColor: '#ffffff' }\">\n              <div class=\"comment-user\">\n                <i class=\"el-icon-user\"></i>\n                <span class=\"username\">{{ comment.nickname || $t('analysis.anonymousUser') }}</span>\n              </div>\n              <div class=\"score-display\">\n                <i v-for=\"n in 5\" :key=\"n\"\n                   :class=\"n <= comment.score ? 'el-icon-star-on' : 'el-icon-star-off'\"\n                   :style=\"{ color: n <= comment.score ? '#f7ba2a' : '#dcdfe6' }\">\n                </i>\n                <span class=\"score-text\">{{ comment.score }}{{ $t('analysis.score') }}</span>\n                <span v-if=\"showSentimentLegend && comment.sentimentScore !== null\" class=\"sentiment-score\">\n                  {{ $t('analysis.sentimentScore') }}: {{ comment.sentimentScore.toFixed(2) }}\n                </span>\n              </div>\n              <div class=\"comment-content\">\n                <template v-if=\"currentLang === 'en' && comment.translatedContent\">\n                  <template v-if=\"!comment.showOriginal\">\n                    {{ comment.translatedContent }}\n                    <div class=\"original-content\" @click=\"toggleOriginalContent(comment)\">\n                      {{ $t('analysis.showOriginal') }}\n                    </div>\n                  </template>\n                  <template v-else>\n                    {{ comment.content }}\n                    <div class=\"original-content\" @click=\"toggleOriginalContent(comment)\">\n                      {{ $t('analysis.showTranslation') }}\n                    </div>\n                  </template>\n                </template>\n                <template v-else>\n                  {{ comment.content }}\n                  <div v-if=\"currentLang === 'en'\" class=\"translate-button\" @click=\"translateComment(comment)\">\n                    {{ $t('analysis.translate') }}\n                  </div>\n                </template>\n              </div>\n              <div class=\"comment-time\" v-if=\"comment.createTime\">\n                {{ new Date(comment.createTime).toLocaleString() }}\n              </div>\n            </div>\n          </div>\n\n          <div class=\"pagination-container\" v-if=\"comments.length > 0\">\n            <el-pagination\n                @current-change=\"handleCurrentChange\"\n                :current-page=\"currentPage\"\n                :page-size=\"pageSize\"\n                layout=\"prev, pager, next\"\n                :total=\"total\">\n            </el-pagination>\n          </div>\n        </el-card>\n      </el-col>\n\n      <!-- 右侧区域 - 评论分析 -->\n      <el-col :span=\"10\">\n        <!-- 评分统计卡片 -->\n        <el-card class=\"analysis-card score-card\">\n          <div slot=\"header\" class=\"card-header\">\n            <span>{{ $t('analysis.scoreDistribution') }}</span>\n            <el-tooltip :content=\"$t('analysis.scoreDistributionTip')\" placement=\"top\">\n              <i class=\"el-icon-info\"></i>\n            </el-tooltip>\n          </div>\n          <div class=\"score-summary\">\n            <div class=\"average-score\" :style=\"{ color: getScoreColor(averageScore) }\">\n              {{ averageScore.toFixed(1) }}\n              <span class=\"score-label\">{{ $t('analysis.averageScore') }}</span>\n            </div>\n            <div class=\"score-bars\">\n              <div v-for=\"i in 5\" :key=\"i\" class=\"score-bar-item\">\n                <span class=\"score-label\">{{ $t('analysis.star' + i) }}</span>\n                <div class=\"score-bar-container\">\n                  <div class=\"score-bar\"\n                       :style=\"{ width: scoreDistribution[i] + '%', backgroundColor: getScoreColor(i) }\">\n                  </div>\n                </div>\n                <span class=\"score-percentage\">{{ scoreDistribution[i] }}%</span>\n              </div>\n            </div>\n          </div>\n        </el-card>\n\n        <!-- 词云卡片 -->\n        <el-card class=\"analysis-card word-cloud-card\">\n          <div slot=\"header\" class=\"card-header\">\n            <span>{{ $t('analysis.keywordCloud') }}</span>\n            <el-tooltip :content=\"$t('analysis.keywordCloudTip')\" placement=\"top\">\n              <i class=\"el-icon-info\"></i>\n            </el-tooltip>\n          </div>\n          <div class=\"word-cloud-container\" ref=\"wordCloudContainer\">\n            <div v-if=\"keywords.length === 0\" class=\"empty-keywords\">\n              <i class=\"el-icon-data-analysis empty-icon\"></i>\n              <p>{{ $t('analysis.emptyKeywords') }}</p>\n            </div>\n            <div v-else class=\"word-cloud\" ref=\"wordCloud\"></div>\n          </div>\n          <div class=\"word-cloud-footer\" v-if=\"keywords.length > 0\">\n            <span>{{ $t('analysis.totalKeywords', { count: keywords.length }) }}</span>\n            <el-button type=\"text\" size=\"mini\" @click=\"exportKeywords\">{{ $t('analysis.exportKeywords') }}</el-button>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'Analysis',\n  data() {\n    return {\n      productId: null,\n      productUrl: '',\n      comments: [],\n      allcomments: [],\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      loading: false,\n      scoreFilter: '0',\n      searchKeyword: '',\n      keywords: [],\n      currentLang: 'zh',\n\n      // 评分统计\n      averageScore: 0,\n      scoreDistribution: {\n        1: 0,\n        2: 0,\n        3: 0,\n        4: 0,\n        5: 0\n      },\n      isAnalyzing: false,\n      showSentimentLegend: false,\n    };\n  },\n  created() {\n    // 从路由参数获取商品ID\n    this.productId = this.$route.params.productId;\n    this.productUrl = this.$route.query.url || '';\n    // 获取当前语言设置\n    this.currentLang = localStorage.getItem('language') || 'zh';\n\n    if (this.productId) {\n      this.getComments();\n      this.getscore();\n    }\n  },\n  watch: {\n    // 监听语言变化\n    '$i18n.locale': {\n      handler(newLang) {\n        this.currentLang = newLang;\n        // 如果切换到英文，自动翻译所有评论和关键词\n        if (newLang === 'en') {\n          this.translateAllComments();\n          this.translateKeywords();\n        }\n      },\n      immediate: true\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', this.resizeWordCloud);\n  },\n  beforeDestroy() {\n    window.removeEventListener('resize', this.resizeWordCloud);\n  },\n  methods: {\n    goBack() {\n      this.$router.push('/');\n    },\n\n    async fetchNewComments() {\n      if (!this.productUrl) {\n        this.$message.warning(this.$t('analysis.noCommentsWarning'));\n        return;\n      }\n\n      this.loading = true;\n\n      try {\n        const response = await axios.get('/comments/fetch', {\n          params: { url: this.productUrl }\n        });\n\n        if (response.data.code === '0') {\n          this.$message.success(this.$t('analysis.fetchCommentsSuccess'));\n          this.getComments();\n          this.getscore();\n        } else {\n          this.$message.error(response.data.msg || this.$t('analysis.fetchCommentsFailed'));\n        }\n      } catch (error) {\n        console.error('获取评论失败:', error);\n        this.$message.error(this.$t('analysis.fetchCommentsFailed') + ': ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async getscore() {\n      this.loading = true;\n\n      try {\n        const response = await axios.get('/comments', {\n          params: {\n            pageNum: 1,\n            pageSize: 20000,\n            productId: this.productId\n          }\n        });\n\n        if (response.data.code === '0') {\n          const data = response.data.data;\n          this.allcomments = data.records || [];\n\n          if (this.allcomments.length === 0) {\n            this.$message.warning('暂无评论数据，请点击上方按钮获取评论');\n            return;\n          }\n\n          // 计算评分统计\n          this.calculateScoreDistribution();\n        } else {\n          this.$message.warning(response.data.msg || '未找到评论数据');\n        }\n      } catch (error) {\n        console.error('获取评论列表失败:', error);\n        this.$message.error('获取评论列表失败: ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async getComments() {\n      this.loading = true;\n\n      try {\n        const response = await axios.get('/comments', {\n          params: {\n            pageNum: this.currentPage,\n            pageSize: this.pageSize,\n            productId: this.productId\n          }\n        });\n\n        if (response.data.code === '0') {\n          const data = response.data.data;\n          // 确保评论数据中包含翻译相关字段\n          this.comments = (data.records || []).map(comment => ({\n            ...comment,\n            sentimentScore: comment.sentimentScore || null,\n            translatedContent: null,\n            showOriginal: false\n          }));\n          this.total = data.total || 0;\n\n          if (this.comments.length === 0) {\n            this.$message.warning(this.$t('analysis.noCommentsWarning'));\n            return;\n          }\n\n          // 获取关键词\n          this.getKeywords();\n          \n          // 如果当前是英文，自动翻译所有评论\n          if (this.currentLang === 'en') {\n            this.translateAllComments();\n          }\n        } else {\n          this.$message.warning(response.data.msg || this.$t('analysis.fetchCommentsFailed'));\n        }\n      } catch (error) {\n        console.error('获取评论列表失败:', error);\n        this.$message.error(this.$t('analysis.fetchCommentsFailed') + ': ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async getKeywords() {\n      try {\n        const response = await axios.get(`/comments/keywords1/${this.productId}`, {\n          params: { topN: 50 }\n        });\n\n        if (response.data.code === '0') {\n          const keywordsObj = response.data.data.keywords || {};\n\n          // 将对象转换为数组格式，适用于词云\n          this.keywords = Object.entries(keywordsObj).map(([text, value]) => ({\n            text,\n            value,\n            translatedText: null  // 添加翻译文本字段\n          }));\n\n          // 如果当前是英文，翻译关键词\n          if (this.currentLang === 'en') {\n            for (const keyword of this.keywords) {\n              await this.translateComment({ content: keyword.text });  // 使用现有的翻译方法\n              keyword.text = keyword.translatedContent;  // 更新关键词文本\n            }\n          }\n\n          // 在下一个渲染周期绘制词云\n          this.$nextTick(() => {\n            this.renderWordCloud();\n          });\n        }\n      } catch (error) {\n        console.error('获取关键词失败:', error);\n      }\n    },\n\n    async translateKeywords() {\n      for (const keyword of this.keywords) {\n        try {\n          const response = await axios.post('/api/translate', {\n            text: keyword.text,\n            targetLang: 'en'\n          });\n\n          if (response.data && response.data.code === '0') {\n            keyword.text = response.data.data;\n          }\n        } catch (error) {\n          console.error('翻译关键词失败:', error);\n        }\n      }\n    },\n\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      if (this.scoreFilter !== '0') {\n        // 如果当前有评分筛选，使用评分筛选接口\n        this.filterComments();\n      } else {\n        // 否则使用普通评论获取接口\n        this.getComments();\n      }\n    },\n\n    async filterComments() {\n      if (this.scoreFilter === '0') {\n        // 重置为全部评论\n        this.currentPage = 1;\n        this.getComments();\n        return;\n      }\n\n      this.loading = true;\n      const minScore = parseInt(this.scoreFilter);\n      const maxScore = parseInt(this.scoreFilter);\n\n      try {\n        const response = await axios.get(`/comments/score/${this.productId}`, {\n          params: {\n            minScore,\n            maxScore,\n            pageNum: this.currentPage,\n            pageSize: this.pageSize\n          }\n        });\n\n        if (response.data.code === '0') {\n          // 检查返回数据的结构\n          if (response.data.data.records) {\n            // 如果返回的是分页格式\n            this.comments = response.data.data.records.map(comment => ({\n              ...comment,\n              sentimentScore: comment.sentimentScore || null\n            }));\n            this.total = response.data.data.total;\n          } else if (Array.isArray(response.data.data)) {\n            // 如果返回的是数组格式，手动处理分页\n            const start = (this.currentPage - 1) * this.pageSize;\n            const end = start + this.pageSize;\n            this.comments = response.data.data.slice(start, end).map(comment => ({\n              ...comment,\n              sentimentScore: comment.sentimentScore || null\n            }));\n            this.total = response.data.data.length;\n          } else {\n            this.comments = [];\n            this.total = 0;\n          }\n\n          // 如果有情感分析数据，显示图例\n          if (this.comments.some(comment => comment.sentimentScore !== null)) {\n            this.showSentimentLegend = true;\n          }\n        } else {\n          this.$message.warning(response.data.msg || this.$t('analysis.filterCommentsFailed'));\n        }\n      } catch (error) {\n        console.error('筛选评论失败:', error);\n        this.$message.error(this.$t('analysis.filterCommentsFailed') + ': ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async searchComments() {\n      if (!this.searchKeyword.trim()) {\n        // 如果搜索关键词为空，恢复显示所有评论\n        this.currentPage = 1;\n        this.getComments();\n        return;\n      }\n\n      this.loading = true;\n\n      try {\n        const response = await axios.get(`/comments/search/${this.productId}`, {\n          params: {\n            keyword: this.searchKeyword.trim()\n          }\n        });\n\n        if (response.data.code === '0') {\n          this.comments = (response.data.data || []).map(comment => ({\n            ...comment,\n            sentimentScore: comment.sentimentScore || null\n          }));\n          this.total = this.comments.length;\n          this.currentPage = 1;\n\n          // 如果有情感分析数据，显示图例\n          if (this.comments.some(comment => comment.sentimentScore !== null)) {\n            this.showSentimentLegend = true;\n          }\n        } else {\n          this.$message.warning(response.data.msg || this.$t('analysis.searchCommentsFailed'));\n        }\n      } catch (error) {\n        console.error('搜索评论失败:', error);\n        this.$message.error(this.$t('analysis.searchCommentsFailed') + ': ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    calculateScoreDistribution() {\n      if (!this.allcomments || this.allcomments.length === 0) {\n        this.averageScore = 0;\n        this.scoreDistribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\n        return;\n      }\n\n      // 初始化计数器\n      const scoreCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\n      let totalScore = 0;\n\n      // 计算每个评分的数量和总分\n      this.allcomments.forEach(comment => {\n        if (comment.score >= 1 && comment.score <= 5) {\n          scoreCounts[comment.score]++;\n          totalScore += comment.score;\n        }\n      });\n\n      // 计算平均分\n      this.averageScore = totalScore / this.allcomments.length;\n\n      // 计算每个评分的百分比\n      const total = this.allcomments.length;\n      for (let i = 1; i <= 5; i++) {\n        this.scoreDistribution[i] = Math.round((scoreCounts[i] / total) * 100);\n      }\n    },\n\n    renderWordCloud() {\n      if (!this.keywords || this.keywords.length === 0 || !this.$refs.wordCloud) return;\n\n      const container = this.$refs.wordCloud;\n      container.innerHTML = '';\n\n      // 设置字体大小范围\n      const maxFontSize = 42;\n      const minFontSize = 14;\n\n      // 找出最大和最小权重值\n      const values = this.keywords.map(item => item.value);\n      const maxValue = Math.max(...values);\n      const minValue = Math.min(...values);\n\n      // 定义一组美观的颜色\n      const colors = [\n        '#3a7bd5', '#00d2ff', '#11998e', '#38ef7d',\n        '#a8ff78', '#f857a6', '#ff5858', '#fcb045',\n        '#7b4397', '#dc2430', '#4568dc', '#b06ab3'\n      ];\n\n      this.keywords.forEach(keyword => {\n        const span = document.createElement('span');\n        span.className = 'keyword';\n        span.textContent = keyword.text;\n\n        // 计算字体大小\n        const fontSize = minValue === maxValue\n            ? (maxFontSize + minFontSize) / 2\n            : minFontSize + (keyword.value - minValue) / (maxValue - minValue) * (maxFontSize - minFontSize);\n\n        // 随机选择颜色\n        const color = colors[Math.floor(Math.random() * colors.length)];\n\n        // 设置样式\n        span.style.fontSize = `${fontSize}px`;\n        span.style.color = color;\n        span.style.fontWeight = Math.floor(fontSize / 5) * 100;\n        span.style.opacity = 0.9 - (0.3 * (fontSize - minFontSize) / (maxFontSize - minFontSize));\n        span.style.transition = 'all 0.3s ease';\n\n        // 鼠标悬停效果\n        span.onmouseenter = () => {\n          span.style.backgroundColor = '#f5f7fa';\n          span.style.opacity = '1';\n        };\n        span.onmouseleave = () => {\n          span.style.backgroundColor = 'transparent';\n        };\n\n        container.appendChild(span);\n      });\n    },\n\n    resizeWordCloud() {\n      this.renderWordCloud();\n    },\n\n    getScoreColor(score) {\n      if (score >= 4.5) return '#67C23A'; // 绿色 - 优秀\n      if (score >= 4) return '#85CE61';   // 浅绿色 - 良好\n      if (score >= 3) return '#E6A23C';   // 黄色 - 一般\n      if (score >= 2) return '#F56C6C';   // 红色 - 较差\n      return '#F56C6C';                   // 深红色 - 很差\n    },\n\n    exportKeywords() {\n      // 将关键词转换为CSV格式\n      const csvContent = \"data:text/csv;charset=utf-8,\"\n          + \"关键词,频率\\n\"\n          + this.keywords.map(k => `${k.text},${k.value}`).join(\"\\n\");\n\n      // 创建下载链接\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", `商品_${this.productId}_关键词.csv`);\n      document.body.appendChild(link);\n\n      // 触发下载\n      link.click();\n      document.body.removeChild(link);\n\n      this.$message.success(this.$t('analysis.exportKeywordsSuccess'));\n    },\n\n    async analyzeSentiment() {\n      if (this.comments.length === 0) {\n        this.$message.warning(this.$t('analysis.noCommentsWarning'));\n        return;\n      }\n\n      this.isAnalyzing = true;\n      this.showSentimentLegend = true;\n\n      try {\n        const response = await axios.post(`/comments/sentiment/${this.productId}`, {\n          comments: this.comments.map(comment => ({\n            id: comment.id,\n            content: comment.content\n          }))\n        });\n\n        if (response.data.code === '0') {\n          const sentimentResults = response.data.data;\n          // 更新评论的情感分数\n          this.comments = this.comments.map(comment => {\n            const sentimentScore = sentimentResults[comment.id];\n            return {\n              ...comment,\n              sentimentScore: sentimentScore !== undefined ? sentimentScore : 0.5\n            };\n          });\n          this.$message.success(this.$t('analysis.sentimentAnalysisSuccess'));\n        } else {\n          this.$message.error(response.data.msg || this.$t('analysis.sentimentAnalysisFailed'));\n        }\n      } catch (error) {\n        console.error('情感分析失败:', error);\n        this.$message.error(this.$t('analysis.sentimentAnalysisFailed') + ': ' + (error.response?.data?.msg || error.message));\n      } finally {\n        this.isAnalyzing = false;\n      }\n    },\n\n    getSentimentStyle(score) {\n      // 根据情感分数返回对应的背景色\n      if (score >= 0.6) {\n        return { backgroundColor: 'rgba(103, 194, 58, 0.1)' }; // 积极 - 浅绿色\n      } else if (score >= 0.4) {\n        return { backgroundColor: 'rgba(230, 162, 60, 0.1)' }; // 中性 - 浅黄色\n      } else {\n        return { backgroundColor: 'rgba(245, 108, 108, 0.1)' }; // 消极 - 浅红色\n      }\n    },\n\n    async translateComment(comment) {\n      if (!comment.content) return;\n      \n      try {\n        const response = await axios.post('/api/translate', {\n          text: comment.content,\n          targetLang: 'en'\n        });\n\n        if (response.data && response.data.code === '0') {\n          // 使用 Vue.set 确保响应式更新\n          this.$set(comment, 'translatedContent', response.data.data);\n          this.$set(comment, 'showOriginal', false);\n        } else {\n          this.$message.error(response.data.msg || this.$t('analysis.translateFailed'));\n        }\n      } catch (error) {\n        console.error('翻译失败:', error);\n        this.$message.error(this.$t('analysis.translateFailed'));\n      }\n    },\n\n    async translateAllComments() {\n      for (const comment of this.comments) {\n        if (!comment.translatedContent) {\n          await this.translateComment(comment);\n        }\n      }\n    },\n\n    toggleOriginalContent(comment) {\n      this.$set(comment, 'showOriginal', !comment.showOriginal);\n    },\n  }\n};\n</script>\n\n<style scoped>\n.analysis-container {\n  padding: 20px;\n  background-color: #f5f7fa;\n  min-height: 100vh;\n}\n\n.header-area {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20px;\n  padding: 0 10px;\n}\n\n.back-button {\n  cursor: pointer;\n  color: #409EFF;\n  font-size: 14px;\n  margin-right: 20px;\n  transition: color 0.3s;\n}\n\n.back-button:hover {\n  color: #66b1ff;\n}\n\n.product-title {\n  flex: 1;\n  margin: 0;\n  font-size: 20px;\n  color: #303133;\n  font-weight: 500;\n}\n\n.action-buttons {\n  display: flex;\n  align-items: center;\n  gap: 15px;\n}\n\n.sentiment-button {\n  cursor: pointer;\n  color: #409EFF;\n  font-size: 14px;\n  transition: color 0.3s;\n  display: flex;\n  align-items: center;\n  gap: 5px;\n}\n\n.sentiment-button:hover {\n  color: #66b1ff;\n}\n\n.refresh-button, .loading-indicator {\n  cursor: pointer;\n  color: #409EFF;\n  font-size: 14px;\n  transition: color 0.3s;\n}\n\n.refresh-button:hover {\n  color: #66b1ff;\n}\n\n.loading-indicator i {\n  animation: rotating 2s linear infinite;\n}\n\n@keyframes rotating {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.main-content {\n  margin-bottom: 20px;\n}\n\n.comment-card, .analysis-card {\n  margin-bottom: 20px;\n  border-radius: 12px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  transition: all 0.3s;\n}\n\n.comment-card:hover, .analysis-card:hover {\n  box-shadow: 0 2px 16px 0 rgba(0, 0, 0, 0.1);\n}\n\n.comment-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid #f0f2f5;\n}\n\n.comment-filter {\n  display: flex;\n  align-items: center;\n}\n\n.search-input {\n  width: 200px;\n  margin-left: 10px;\n  transition: width 0.3s;\n}\n\n.search-input:focus-within {\n  width: 250px;\n}\n\n.empty-comments, .empty-keywords {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 50px 0;\n  color: #909399;\n}\n\n.empty-icon {\n  font-size: 48px;\n  margin-bottom: 15px;\n  opacity: 0.6;\n}\n\n.comment-list {\n  max-height: 600px;\n  overflow-y: auto;\n  padding: 0 10px;\n}\n\n.comment-item {\n  position: relative;\n  transition: background-color 0.3s;\n  background-color: #ffffff;\n  border-radius: 4px;\n  padding: 15px;\n  margin-bottom: 10px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.comment-item:hover {\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n}\n\n.comment-item.has-sentiment {\n  border-radius: 4px;\n  padding: 15px;\n}\n\n.comment-user {\n  display: flex;\n  align-items: center;\n  margin-bottom: 5px;\n}\n\n.comment-user i {\n  font-size: 16px;\n  color: #909399;\n}\n\n.username {\n  margin-left: 8px;\n  font-weight: 500;\n  color: #606266;\n}\n\n.score-display {\n  margin-bottom: 10px;\n  display: flex;\n  align-items: center;\n}\n\n.score-display i {\n  margin-right: 2px;\n}\n\n.score-text {\n  margin-left: 8px;\n  color: #909399;\n  font-size: 13px;\n}\n\n.comment-content {\n  position: relative;\n  line-height: 1.6;\n  color: #303133;\n  margin-bottom: 8px;\n  word-break: break-word;\n}\n\n.translate-button {\n  display: inline-block;\n  margin-left: 10px;\n  color: #409EFF;\n  cursor: pointer;\n  font-size: 12px;\n}\n\n.translate-button:hover {\n  color: #66b1ff;\n}\n\n.original-content {\n  display: inline-block;\n  margin-left: 10px;\n  color: #409EFF;\n  cursor: pointer;\n  font-size: 12px;\n}\n\n.original-content:hover {\n  color: #66b1ff;\n}\n\n.comment-time {\n  font-size: 12px;\n  color: #909399;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: center;\n  padding: 10px 0;\n}\n\n/* 评分统计卡片 */\n.score-card .card-header {\n  border-bottom: 1px solid #f0f2f5;\n}\n\n.score-summary {\n  display: flex;\n  padding: 20px 10px;\n}\n\n.average-score {\n  width: 100px;\n  font-size: 36px;\n  font-weight: bold;\n  text-align: center;\n  margin-right: 20px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.score-label {\n  display: block;\n  font-size: 14px;\n  font-weight: normal;\n  color: #909399;\n  margin-top: 5px;\n}\n\n.score-bars {\n  flex: 1;\n}\n\n.score-bar-item {\n  display: flex;\n  align-items: center;\n  margin-bottom: 12px;\n}\n\n.score-bar-container {\n  flex: 1;\n  height: 10px;\n  background-color: #ebeef5;\n  border-radius: 5px;\n  overflow: hidden;\n  margin: 0 10px;\n}\n\n.score-bar {\n  height: 100%;\n  border-radius: 5px;\n  transition: width 0.6s ease;\n}\n\n.score-percentage {\n  width: 40px;\n  text-align: right;\n  font-size: 13px;\n  color: #606266;\n}\n\n/* 词云卡片 */\n.word-cloud-card {\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n  transition: all 0.3s ease;\n}\n\n.word-cloud-card:hover {\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid #f0f2f5;\n}\n\n.card-header .el-icon-info {\n  color: #909399;\n  cursor: pointer;\n  font-size: 16px;\n  transition: color 0.3s;\n}\n\n.card-header .el-icon-info:hover {\n  color: #409EFF;\n}\n\n.word-cloud-container {\n  height: 300px;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #f9fafc 0%, #f0f2f5 100%);\n  border-radius: 8px;\n  margin: 10px;\n  overflow: hidden;\n}\n\n.word-cloud {\n  width: 90%;\n  height: 90%;\n  text-align: center;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: center;\n  padding: 15px;\n  position: relative;\n}\n\n.keyword {\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin: 5px;\n  padding: 3px 8px;\n  border-radius: 4px;\n  display: inline-block;\n  font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;\n  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n}\n\n.keyword:hover {\n  transform: scale(1.15);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  z-index: 10;\n}\n\n.empty-keywords {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #c0c4cc;\n  height: 100%;\n}\n\n.empty-icon {\n  font-size: 48px;\n  margin-bottom: 15px;\n  opacity: 0.6;\n}\n\n.word-cloud-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 16px;\n  border-top: 1px solid #f0f2f5;\n  font-size: 12px;\n  color: #909399;\n}\n\n.word-cloud-footer .el-button {\n  padding: 0;\n}\n\n.sentiment-legend {\n  display: flex;\n  justify-content: center;\n  gap: 20px;\n  padding: 10px;\n  margin-bottom: 15px;\n  background-color: #f5f7fa;\n  border-radius: 4px;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  gap: 5px;\n  font-size: 12px;\n  color: #606266;\n}\n\n.color-block {\n  width: 20px;\n  height: 20px;\n  border-radius: 4px;\n}\n\n.color-block.positive {\n  background-color: rgba(103, 194, 58, 0.1);\n}\n\n.color-block.neutral {\n  background-color: rgba(230, 162, 60, 0.1);\n}\n\n.color-block.negative {\n  background-color: rgba(245, 108, 108, 0.1);\n}\n\n.sentiment-score {\n  margin-left: 10px;\n  font-size: 12px;\n  color: #909399;\n}\n</style>"]}]}